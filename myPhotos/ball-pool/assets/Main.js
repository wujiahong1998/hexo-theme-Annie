// build time:Tue Feb 04 2020 16:10:30 GMT+0800 (GMT+08:00)
var canvas;var delta=[0,0];var stage=[window.screenX,window.screenY,window.innerWidth,window.innerHeight];getBrowserDimensions();var themes=[["#10222B","#95AB63","#BDD684","#E2F0D6","#F6FFE0"],["#362C2A","#732420","#BF734C","#FAD9A0","#736859"],["#0D1114","#102C2E","#695F4C","#EBBC5E","#FFFBB8"],["#2E2F38","#FFD63E","#FFB54B","#E88638","#8A221C"],["#121212","#E6F2DA","#C9F24B","#4D7B85","#23383D"],["#343F40","#736751","#F2D7B6","#BFAC95","#8C3F3F"],["#000000","#2D2B2A","#561812","#B81111","#FFFFFF"],["#333B3A","#B4BD51","#543B38","#61594D","#B8925A"]];var theme;var worldAABB,world,iterations=1,timeStep=1/15;var walls=[];var wall_thickness=200;var wallsSetted=false;var bodies,elements,text;var createMode=false;var destroyMode=false;var isMouseDown=false;var mouseJoint;var mouse={x:0,y:0};var gravity={x:0,y:1};var PI2=Math.PI*2;var timeOfLastTouch=0;init();play();function init(){canvas=document.getElementById("canvas");document.onmousedown=onDocumentMouseDown;document.onmouseup=onDocumentMouseUp;document.onmousemove=onDocumentMouseMove;document.ondblclick=onDocumentDoubleClick;document.addEventListener("touchstart",onDocumentTouchStart,false);document.addEventListener("touchmove",onDocumentTouchMove,false);document.addEventListener("touchend",onDocumentTouchEnd,false);window.addEventListener("deviceorientation",onWindowDeviceOrientation,false);worldAABB=new b2AABB;worldAABB.minVertex.Set(-200,-200);worldAABB.maxVertex.Set(window.innerWidth+200,window.innerHeight+200);world=new b2World(worldAABB,new b2Vec2(0,0),true);setWalls();reset()}function play(){setInterval(loop,1e3/40)}function reset(){var e;if(bodies){for(e=0;e<bodies.length;e++){var t=bodies[e];canvas.removeChild(t.GetUserData().element);world.DestroyBody(t);t=null}}theme=themes[Math.random()*themes.length>>0];document.body.style["backgroundColor"]=theme[0];bodies=[];elements=[];createInstructions();for(e=0;e<10;e++){createBall()}}function onDocumentMouseDown(){isMouseDown=true;return false}function onDocumentMouseUp(){isMouseDown=false;return false}function onDocumentMouseMove(e){mouse.x=e.clientX;mouse.y=e.clientY}function onDocumentDoubleClick(){reset()}function onDocumentTouchStart(e){if(e.touches.length==1){e.preventDefault();var t=(new Date).getTime();if(t-timeOfLastTouch<250){reset();return}timeOfLastTouch=t;mouse.x=e.touches[0].pageX;mouse.y=e.touches[0].pageY;isMouseDown=true}}function onDocumentTouchMove(e){if(e.touches.length==1){e.preventDefault();mouse.x=e.touches[0].pageX;mouse.y=e.touches[0].pageY}}function onDocumentTouchEnd(e){if(e.touches.length==0){e.preventDefault();isMouseDown=false}}function onWindowDeviceOrientation(e){if(e.beta){gravity.x=Math.sin(e.gamma*Math.PI/180);gravity.y=Math.sin(Math.PI/4+e.beta*Math.PI/180)}}function createInstructions(){var e=250;var t=document.createElement("div");t.width=e;t.height=e;t.style.position="absolute";t.style.left=-200+"px";t.style.top=-200+"px";t.style.cursor="default";canvas.appendChild(t);elements.push(t);var o=document.createElement("canvas");o.width=e;o.height=e;var n=o.getContext("2d");n.fillStyle=theme[3];n.beginPath();n.arc(e*.5,e*.5,e*.5,0,PI2,true);n.closePath();n.fill();t.appendChild(o);text=document.createElement("div");text.onSelectStart=null;text.innerHTML='<span style="color:'+theme[0]+';font-size:26px;">玩法介绍：</span><br /><span style="font-size:15px;"><br />1. 随意拖动圆球；<br />2.点击页面背景；<br />3. 晃动浏览器；<br />4. 双击页面背景；<br />5. 按住鼠标左键。</span>';text.style.color=theme[1];text.style.position="absolute";text.style.left="0px";text.style.top="0px";text.style.fontFamily="Georgia";text.style.textAlign="center";t.appendChild(text);text.style.left=(250-text.clientWidth)/2+"px";text.style.top=(250-text.clientHeight)/2+"px";var a=new b2BodyDef;var o=new b2CircleDef;o.radius=e/2;o.density=1;o.friction=.3;o.restitution=.3;a.AddShape(o);a.userData={element:t};a.position.Set(Math.random()*stage[2],Math.random()*-200);a.linearVelocity.Set(Math.random()*400-200,Math.random()*400-200);bodies.push(world.CreateBody(a))}function createBall(e,t){var e=e||Math.random()*stage[2];var t=t||Math.random()*-200;var o=(Math.random()*100>>0)+20;var n=document.createElement("canvas");n.width=o;n.height=o;n.style.position="absolute";n.style.left=-200+"px";n.style.top=-200+"px";n.style.WebkitTransform="translateZ(0)";n.style.MozTransform="translateZ(0)";n.style.OTransform="translateZ(0)";n.style.msTransform="translateZ(0)";n.style.transform="translateZ(0)";var a=n.getContext("2d");var s=Math.random()*10>>0;for(var r=o;r>0;r-=o/s){a.fillStyle=theme[(Math.random()*4>>0)+1];a.beginPath();a.arc(o*.5,o*.5,r*.5,0,PI2,true);a.closePath();a.fill()}canvas.appendChild(n);elements.push(n);var l=new b2BodyDef;var i=new b2CircleDef;i.radius=o>>1;i.density=1;i.friction=.3;i.restitution=.3;l.AddShape(i);l.userData={element:n};l.position.Set(e,t);l.linearVelocity.Set(Math.random()*400-200,Math.random()*400-200);bodies.push(world.CreateBody(l))}function loop(){if(getBrowserDimensions()){setWalls()}delta[0]+=(0-delta[0])*.5;delta[1]+=(0-delta[1])*.5;world.m_gravity.x=gravity.x*350+delta[0];world.m_gravity.y=gravity.y*350+delta[1];mouseDrag();world.Step(timeStep,iterations);for(i=0;i<bodies.length;i++){var e=bodies[i];var t=elements[i];t.style.left=e.m_position0.x-(t.width>>1)+"px";t.style.top=e.m_position0.y-(t.height>>1)+"px";if(t.tagName=="DIV"){var o="rotate("+e.m_rotation0*57.2957795+"deg) translateZ(0)";text.style.WebkitTransform=o;text.style.MozTransform=o;text.style.OTransform=o;text.style.msTransform=o;text.style.transform=o}}}function createBox(e,t,o,n,a,s){if(typeof s=="undefined"){s=true}var r=new b2BoxDef;if(!s){r.density=1}r.extents.Set(n,a);var l=new b2BodyDef;l.AddShape(r);l.position.Set(t,o);return e.CreateBody(l)}function mouseDrag(){if(createMode){createBall(mouse.x,mouse.y)}else if(isMouseDown&&!mouseJoint){var e=getBodyAtMouse();if(e){var t=new b2MouseJointDef;t.body1=world.m_groundBody;t.body2=e;t.target.Set(mouse.x,mouse.y);t.maxForce=3e4*e.m_mass;mouseJoint=world.CreateJoint(t);e.WakeUp()}else{createMode=true}}if(!isMouseDown){createMode=false;destroyMode=false;if(mouseJoint){world.DestroyJoint(mouseJoint);mouseJoint=null}}if(mouseJoint){var o=new b2Vec2(mouse.x,mouse.y);mouseJoint.SetTarget(o)}}function getBodyAtMouse(){var e=new b2Vec2;e.Set(mouse.x,mouse.y);var t=new b2AABB;t.minVertex.Set(mouse.x-1,mouse.y-1);t.maxVertex.Set(mouse.x+1,mouse.y+1);var o=10;var n=new Array;var a=world.Query(t,n,o);var s=null;for(var r=0;r<a;++r){if(n[r].m_body.IsStatic()==false){if(n[r].TestPoint(e)){s=n[r].m_body;break}}}return s}function setWalls(){if(wallsSetted){world.DestroyBody(walls[0]);world.DestroyBody(walls[1]);world.DestroyBody(walls[2]);world.DestroyBody(walls[3]);walls[0]=null;walls[1]=null;walls[2]=null;walls[3]=null}walls[0]=createBox(world,stage[2]/2,-wall_thickness,stage[2],wall_thickness);walls[1]=createBox(world,stage[2]/2,stage[3]+wall_thickness,stage[2],wall_thickness);walls[2]=createBox(world,-wall_thickness,stage[3]/2,wall_thickness,stage[3]);walls[3]=createBox(world,stage[2]+wall_thickness,stage[3]/2,wall_thickness,stage[3]);wallsSetted=true}function getBrowserDimensions(){var e=false;if(stage[0]!=window.screenX){delta[0]=(window.screenX-stage[0])*50;stage[0]=window.screenX;e=true}if(stage[1]!=window.screenY){delta[1]=(window.screenY-stage[1])*50;stage[1]=window.screenY;e=true}if(stage[2]!=window.innerWidth){stage[2]=window.innerWidth;e=true}if(stage[3]!=window.innerHeight){stage[3]=window.innerHeight;e=true}return e}
//rebuild by neat 